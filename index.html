<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>To-Do List App</title>

    <!-- Bootstrap CSS -->
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" />

    <style>
      #app {
        margin: 20px;
      }

      #taskForm {
        margin-bottom: 20px;
      }

      .task-item {
        border: 1px solid #ddd;
        margin-bottom: 10px;
        padding: 10px;
      }
    </style>
  </head>
  <body>
    <div id="app" class="container">
      <!-- Task Input and Management -->
      <form id="taskForm" class="form-inline">
        <div class="form-group mx-sm-3 mb-2">
          <label for="taskName" class="sr-only">Task Name:</label>
          <input
            type="text"
            class="form-control"
            id="taskName"
            placeholder="Task Name"
            required />
        </div>
        <div class="form-group mx-sm-3 mb-2">
          <label for="dueDate" class="sr-only">Due Date:</label>
          <input type="date" class="form-control" id="dueDate" />
        </div>
        <div class="form-group mx-sm-3 mb-2">
          <label for="priority" class="sr-only">Priority:</label>
          <select id="priority" class="form-control">
            <option value="high">High</option>
            <option value="medium" selected>Medium</option>
            <option value="low">Low</option>
          </select>
        </div>
        <button type="button" class="btn btn-primary mb-2" onclick="addTask()">
          Add Task
        </button>
      </form>

      <!-- Filter and Search -->
      <div class="form-row">
        <div class="form-group col-md-4">
          <label for="filterStatus">Filter by Status:</label>
          <select
            id="filterStatus"
            class="form-control"
            onchange="filterTasks()">
            <option value="all">All</option>
            <option value="to-do">To-do</option>
            <option value="in-progress">In Progress</option>
            <option value="done">Done</option>
          </select>
        </div>

        <div class="form-group col-md-4">
          <label for="filterPriority">Filter by Priority:</label>
          <select
            id="filterPriority"
            class="form-control"
            onchange="filterTasks()">
            <option value="all">All</option>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
        </div>

        <div class="form-group col-md-4">
          <label for="search">Search:</label>
          <input
            type="text"
            id="search"
            class="form-control"
            oninput="filterTasks()" />
        </div>
      </div>

      <!-- Task Display and Interaction -->
      <div id="taskList"></div>

      <!-- Task Count -->
      <div id="taskCount"></div>
    </div>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
      // Your JavaScript code goes here
      let tasks = [];

      // Function to add a new task
      function addTask() {
        const taskName = document.getElementById("taskName").value;
        const dueDate = document.getElementById("dueDate").value;
        const priority = document.getElementById("priority").value;

        if (taskName.trim() !== "") {
          const task = {
            name: taskName,
            dueDate: dueDate || "No due date",
            priority: priority,
            status: "To-do",
          };

          tasks.push(task);
          saveTasksToLocalStorage();
          displayTasks();
          clearInputFields();
        } else {
          alert("Please enter a task name.");
        }
      }

      // Function to save tasks to local storage
      function saveTasksToLocalStorage() {
        localStorage.setItem("tasks", JSON.stringify(tasks));
      }

      // Function to get tasks from local storage
      function getTasksFromLocalStorage() {
        const storedTasks = localStorage.getItem("tasks");
        return storedTasks ? JSON.parse(storedTasks) : [];
      }

      // Function to display tasks
      function displayTasks() {
        tasks = getTasksFromLocalStorage();
        const taskListContainer = document.getElementById("taskList");
        taskListContainer.innerHTML = "";

        tasks.forEach((task, index) => {
          const taskItem = document.createElement("div");
          taskItem.classList.add("task-item");

          const taskInfo = document.createElement("div");
          taskInfo.innerHTML = `<strong>${task.name}</strong> (Due: ${task.dueDate}, Priority: ${task.priority}, Status: ${task.status})`;
          taskItem.appendChild(taskInfo);

          const editButton = document.createElement("button");
          editButton.innerText = "Edit";
          editButton.onclick = () => enableEdit(index);
          taskItem.appendChild(editButton);

          const updateProgressButton = document.createElement("button");
          updateProgressButton.innerText = "Update Progress";
          updateProgressButton.onclick = () => updateProgress(index);
          taskItem.appendChild(updateProgressButton);

          const deleteButton = document.createElement("button");
          deleteButton.innerText = "Delete";
          deleteButton.onclick = () => deleteTask(index);
          taskItem.appendChild(deleteButton);

          taskListContainer.appendChild(taskItem);
        });

        updateTaskCount();
      }

      // Function to enable editing of a task
      function enableEdit(index) {
        const taskItem = document.querySelectorAll(".task-item")[index];
        const taskInfo = taskItem.querySelector("div");

        const editInput = document.createElement("input");
        editInput.type = "text";
        editInput.value = tasks[index].name;

        const dueDateInput = document.createElement("input");
        dueDateInput.type = "date";
        dueDateInput.value = tasks[index].dueDate;

        const saveButton = document.createElement("button");
        saveButton.innerText = "Save";
        saveButton.onclick = () =>
          saveChanges(index, editInput.value, dueDateInput.value);

        taskInfo.innerHTML = ""; // Clear existing content
        taskInfo.appendChild(editInput);
        taskInfo.appendChild(dueDateInput);
        taskInfo.appendChild(saveButton);
      }

      // Function to save changes after editing a task
      function saveChanges(index, newName, newDueDate) {
        tasks[index].name = newName;
        tasks[index].dueDate = newDueDate;
        saveTasksToLocalStorage();
        displayTasks();
      }

      // Function to update task progress
      function updateProgress(index) {
        const statusOptions = ["To-do", "In Progress", "Done"];
        const currentIndex = statusOptions.indexOf(tasks[index].status);
        const newIndex = (currentIndex + 1) % statusOptions.length;
        tasks[index].status = statusOptions[newIndex];
        saveTasksToLocalStorage();
        displayTasks();
      }

      // Function to delete a task
      function deleteTask(index) {
        const confirmation = confirm(
          "Are you sure you want to delete this task?"
        );
        if (confirmation) {
          tasks.splice(index, 1);
          saveTasksToLocalStorage();
          displayTasks();
        }
      }

      // Function to clear input fields after adding a task
      function clearInputFields() {
        document.getElementById("taskName").value = "";
        document.getElementById("dueDate").value = "";
        document.getElementById("priority").value = "medium";
      }

      // Function to filter tasks based on status, priority, and search
      function filterTasks() {
        const filterStatus = document.getElementById("filterStatus").value;
        const filterPriority = document.getElementById("filterPriority").value;
        const searchQuery = document
          .getElementById("search")
          .value.toLowerCase();

        const filteredTasks = tasks.filter((task) => {
          const statusMatch =
            filterStatus === "all" ||
            task.status.toLowerCase() === filterStatus;
          const priorityMatch =
            filterPriority === "all" ||
            task.priority.toLowerCase() === filterPriority;
          const searchMatch = task.name.toLowerCase().includes(searchQuery);

          return statusMatch && priorityMatch && searchMatch;
        });

        displayFilteredTasks(filteredTasks);
      }

      // Function to display filtered tasks
      function displayFilteredTasks(filteredTasks) {
        const taskListContainer = document.getElementById("taskList");
        taskListContainer.innerHTML = "";

        filteredTasks.forEach((task, index) => {
          const taskItem = document.createElement("div");
          taskItem.classList.add("task-item");

          const taskInfo = document.createElement("div");
          taskInfo.innerHTML = `<strong>${task.name}</strong> (Due: ${task.dueDate}, Priority: ${task.priority}, Status: ${task.status})`;
          taskItem.appendChild(taskInfo);

          const editButton = document.createElement("button");
          editButton.innerText = "Edit";
          editButton.onclick = () => enableEdit(index);
          taskItem.appendChild(editButton);

          const updateProgressButton = document.createElement("button");
          updateProgressButton.innerText = "Update Progress";
          updateProgressButton.onclick = () => updateProgress(index);
          taskItem.appendChild(updateProgressButton);

          const deleteButton = document.createElement("button");
          deleteButton.innerText = "Delete";
          deleteButton.onclick = () => deleteTask(index);
          taskItem.appendChild(deleteButton);

          taskListContainer.appendChild(taskItem);
        });

        updateTaskCount();
      }

      // Function to update task count
      function updateTaskCount() {
        const taskCountContainer = document.getElementById("taskCount");
        const taskCount = {
          "to-do": tasks.filter((task) => task.status === "To-do").length,
          "in-progress": tasks.filter((task) => task.status === "In Progress")
            .length,
          done: tasks.filter((task) => task.status === "Done").length,
        };

        taskCountContainer.innerHTML = `To-Do: ${taskCount["to-do"]} | In Progress: ${taskCount["in-progress"]} | Done: ${taskCount["done"]}`;
      }

      // Initial display of tasks
      displayTasks();
    </script>

    <!-- Bootstrap JS and Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>
